<div class="" style="padding: 20px !important;">
  <div class="row">
    <div class="col-md-12">
      <h2>{{ tallerForm.idTaller > 0 ? tallerForm.idSale : title }}</h2>

      <button mat-icon-button
              style="position: absolute; top: 10px; right: 10px;"
              (click)="fn_cancel()">
          <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>


    <div class="row">
        <div class="col-md-12">
            <!-- Vendedor -->
            <div class="row">
                <div class="col-md-6">
                    <mat-label>Vendedor: </mat-label>
                    <mat-form-field class="with100">
                        <input #cbxSellerCBX
                        type="text"
                                placeholder="Selecciona..."
                                aria-label="Number"
                                matInput
                                [(ngModel)]="tallerForm.sellerDesc"
                                [matAutocomplete]="cbxSeller"
                                (keyup)="comboBoxKeyUp('cbxSellerCBX', cbxSellerCBX.value, $event)"
                                (click)="cbxSellers_Clear()">
                                <button *ngIf="tallerForm.sellerDesc" matSuffix mat-icon-button aria-label="Clear" (click)="cbxSellers_Clear()">
                                    <mat-icon>close</mat-icon>
                                </button>
                        <mat-autocomplete autoActiveFirstOption
                                            #cbxSeller="matAutocomplete"
                                            (optionSelected)="cbxSellers_SelectedOption( $event )">
                            <mat-option *ngFor="let item of cbxSellers" [value]="item">
                                {{ item.name }}
                            </mat-option>

                            <mat-option value="" *ngIf="tallerForm.sellerDesc?.length > 0 && tallerForm.sellerResp?.length > 0">
                                {{ tallerForm.sellerResp }}
                            </mat-option>

                        </mat-autocomplete>
                    </mat-form-field>
                </div>
                <div class="col-md-6">
                    <mat-label>Cliente: </mat-label>
                    <mat-form-field class="with100">
                        <input #cbxCustomerCBX
                        type="text"
                                placeholder="Selecciona..."
                                aria-label="Number"
                                matInput
                                [(ngModel)]="tallerForm.customerDesc"
                                [matAutocomplete]="cbxCustomer"
                                (keyup)="comboBoxKeyUp('cbxCustomerCBX', cbxCustomerCBX.value, $event)"
                                (click)="cbxCustomers_Clear()">
                                <button *ngIf="tallerForm.customerDesc" matSuffix mat-icon-button aria-label="Clear" (click)="cbxCustomers_Clear()">
                                    <mat-icon>close</mat-icon>
                                </button>
                        <mat-autocomplete autoActiveFirstOption
                                            #cbxCustomer="matAutocomplete"
                                            (optionSelected)="cbxCustomers_SelectedOption( $event )">
                            <mat-option *ngFor="let item of cbxCustomers" [value]="item">
                                {{ item.name }}
                            </mat-option>

                            <mat-option value="" *ngIf="tallerForm.customerResp?.length > 0 && tallerForm.customerResp?.length > 0">
                                {{ tallerForm.customerResp }}
                            </mat-option>

                        </mat-autocomplete>
                    </mat-form-field>
                </div>
            </div>

            <!-- Descripción -->
            <div class="row top15px">
                <div class="col-md-12">
                    <mat-form-field class="with100">
                        <mat-label>Descripción</mat-label>
                        <textarea matInput
                        [(ngModel)]="tallerForm.descripcion"
                        placeholder="Ingrese la descripción del taller"
                        rows="4"></textarea>
                    </mat-form-field>
                </div>
            </div>

            <!-- Fechas -->
            <div class="row top15px">
                <div class="col-md-4">
                    <mat-form-field class="with100">
                        <mat-label>Fecha de Ingreso</mat-label>
                        <input matInput
                        [matDatepicker]="pickerIngreso"
                        [(ngModel)]="tallerForm.fechaIngreso"
                        readonly>
                        <mat-datepicker-toggle matIconSuffix [for]="pickerIngreso"></mat-datepicker-toggle>
                        <mat-datepicker #pickerIngreso></mat-datepicker>
                    </mat-form-field>
                </div>

                <div class="col-md-4">
                    <mat-form-field class="with100">
                        <mat-label>Fecha Prometida de Entrega</mat-label>
                        <input matInput
                        [matDatepicker]="pickerPromesa"
                        [(ngModel)]="tallerForm.fechaPrometidaEntrega"
                        placeholder="Seleccione fecha">
                        <mat-datepicker-toggle matIconSuffix [for]="pickerPromesa"></mat-datepicker-toggle>
                        <mat-datepicker #pickerPromesa></mat-datepicker>
                    </mat-form-field>
                </div>

                <div class="col-md-4">
                    <mat-form-field class="with100">
                        <mat-label>Fecha Entregada</mat-label>
                        <input matInput
                        [(ngModel)]="tallerForm.fechaEntregada"
                        readonly
                        placeholder="Se llena automáticamente">
                    </mat-form-field>
                </div>
            </div>

            <!-- Botones de Acción -->
            <div class="row top30px">
                <div class="col-md-12" style="text-align: right;">
                    <button mat-raised-button
                    color="primary"
                    type="button"
                    class="marginRight10px"
                    (click)="fn_saveTaller()">
                    <mat-icon matPrefix class="my-icon">save</mat-icon>
                    {{ tallerForm.idTaller == 0 ? 'Generar folio' : 'Actualizar encabezado' }}</button>
                </div>
            </div>

            <div *ngIf="tallerForm.idTaller > 0">

              <!-- SECCIÓN DE REFACCIONES -->
              <div class="card-refacciones top30px">
                  <div class="header-refacciones">
                      <h3>Refacciones <span class="total-refacciones">Total: {{ totalRefacciones | currency }}</span></h3>
                  </div>

                  <div class="body-refacciones">
                      <!-- RadioButton de tipo -->
                      <div class="row">
                          <div class="col-md-12">
                              <mat-radio-group [(ngModel)]="refaccionTipo" (change)="fn_changeRefaccionTipo(refaccionTipo)" class="radio-group">
                                  <mat-radio-button value="producto" class="radio-option">
                                      <mat-icon>inventory</mat-icon> Producto
                                  </mat-radio-button>
                                  <mat-radio-button value="porDefinir" class="radio-option">
                                      <mat-icon>description</mat-icon> Por Definir
                                  </mat-radio-button>
                              </mat-radio-group>
                          </div>
                      </div>

                      <!-- FORMULARIO PRODUCTO -->
                      <div *ngIf="refaccionTipo === 'producto'" class="form-producto top15px">
                          <div class="row">
                              <div class="col-md-8">
                                  <mat-form-field
                                  style="width: 100%;"
                                  (click)="cbxProducts_Search()">
                                      <input #cbxProductss
                                              type="text"
                                              id="cbxProduct"
                                              style="width: 100%;"
                                              placeholder="Selecciona un producto..."
                                              aria-label="Number"
                                              matInput
                                              [(ngModel)]="refaccionForm.productDesc"
                                              [matAutocomplete]="cbxProduct"
                                              (keyup)="comboBoxKeyUp('cbxProduct', cbxServiciosExternosCBX.value, $event)"
                                              (click)="cbxProducts_Clear()">
                                              <button *ngIf="refaccionForm.productDesc" matSuffix mat-icon-button aria-label="Clear" (click)="cbxProducts_Clear()">
                                                  <mat-icon>close</mat-icon>
                                              </button>
                                      <mat-autocomplete autoActiveFirstOption
                                                          #cbxProduct="matAutocomplete"
                                                          (optionSelected)="cbxProducts_SelectedOption( $event )">
                                          <mat-option *ngFor="let item of cbxProducts" [value]="item">
                                              <mat-icon matPrefix class="my-icon">qr_code</mat-icon>{{ item.nameConcat }}
                                          </mat-option>

                                          <mat-option value="" *ngIf="cbxProducts.length == 0 && refaccionForm.productDesc">
                                              No se encontró nada...
                                          </mat-option>

                                      </mat-autocomplete>
                                  </mat-form-field>
                              </div>
                              <div class="col-md-4">
                                  <mat-form-field class="with100">
                                      <mat-label>Cantidad</mat-label>
                                      <input matInput type="number" [(ngModel)]="refaccionForm.cantidad" min="1" placeholder="1">
                                  </mat-form-field>
                              </div>
                          </div>
                      </div>

                      <!-- FORMULARIO POR DEFINIR -->
                      <div *ngIf="refaccionTipo === 'porDefinir'" class="form-por-definir top15px">
                          <div class="row">
                              <div class="col-md-12">
                                  <mat-form-field class="with100">
                                      <mat-label>Descripción</mat-label>
                                      <input matInput [(ngModel)]="refaccionForm.productDesc" placeholder="Descripción del artículo">
                                  </mat-form-field>
                              </div>
                          </div>
                          <div class="row top10px">
                              <div class="col-md-3">
                                  <mat-form-field class="with100">
                                      <mat-label>Cantidad</mat-label>
                                      <input matInput type="number" [(ngModel)]="refaccionForm.cantidad" min="1" placeholder="1">
                                  </mat-form-field>
                              </div>
                              <div class="col-md-3">
                                  <mat-form-field class="with100">
                                      <mat-label>Costo</mat-label>
                                      <input matInput type="number" [(ngModel)]="refaccionForm.costo" min="0" placeholder="0">
                                  </mat-form-field>
                              </div>
                              <div class="col-md-3">
                                  <mat-form-field class="with100">
                                      <mat-label>Precio</mat-label>
                                      <input matInput type="number" [(ngModel)]="refaccionForm.precio" min="0" placeholder="0">
                                  </mat-form-field>
                              </div>
                              <div class="col-md-3">
                                  <div class="total-display">
                                      <strong>Total:</strong> {{ (refaccionForm.cantidad * refaccionForm.precio) | currency }}
                                  </div>
                              </div>
                          </div>
                      </div>

                      <!-- BOTÓN AGREGAR -->
                      <div class="row top15px">
                          <div class="col-md-12">
                              <button mat-raised-button color="accent" (click)="fn_agregarRefaccion()" class="btn-agregar">
                                  <mat-icon>add</mat-icon>{{ ( refaccionForm.idRefaccion > 0 ? 'Editar' : 'Agregar' ) }} Refacción
                              </button>
                          </div>
                      </div>

                      <!-- TABLA DE REFACCIONES -->
                      <div *ngIf="refaccionesList.length > 0" class="table-refacciones top20px">
                          <div class="table-responsive">
                              <table class="table table-hover">
                                  <thead>
                                      <tr class="header-table">
                                          <th class="col-descripcion">Descripción</th>
                                          <th class="col-cantidad">Cantidad</th>
                                          <th class="col-precio">Precio Unit.</th>
                                          <th class="col-total">Total</th>
                                          <th class="col-acciones">Acciones</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <tr *ngFor="let item of refaccionesList" class="row-refaccion">
                                          <td class="col-descripcion">
                                              <mat-icon *ngIf="item.tipo === 'producto'" class="icon-tipo" matTooltip="Producto">inventory</mat-icon>
                                              <mat-icon *ngIf="item.tipo === 'porDefinir'" class="icon-tipo" matTooltip="Por Definir">description</mat-icon>
                                              {{ item.productDesc }}
                                          </td>
                                          <td class="col-cantidad text-center">{{ item.cantidad | number:'1.0-0' }}</td>
                                          <td class="col-precio text-right">{{ item.precio | currency }}</td>
                                          <td class="col-total text-right"><strong>{{ item.total | currency }}</strong></td>
                                          <td class="col-acciones text-center">
                                            <button mat-icon-button (click)="editRefaccionGrid(item)" matTooltip="Editar Refacción">
                                                <mat-icon class="colorGreen">edit</mat-icon>
                                            </button>
                                            <button mat-icon-button (click)="fn_eliminarRefaccion(item.idRefaccion)" matTooltip="Eliminar">
                                                <mat-icon class="icon-delete">delete_outline</mat-icon>
                                            </button>
                                          </td>
                                      </tr>
                                  </tbody>
                              </table>
                          </div>
                      </div>

                      <!-- MENSAJE VACÍO -->
                      <div *ngIf="refaccionesList.length === 0" class="empty-state top20px">
                          <mat-icon>folder_open</mat-icon>
                          <p>No hay refacciones agregadas</p>
                      </div>
                  </div>
              </div>

              <!-- SECCIÓN SERVICIOS EXTERNOS -->
              <div class="card-refacciones top30px">
                  <div class="header-refacciones">
                      <h3>Servicios Externos <span class="total-servicios">Total: {{ totalServiciosExternos | currency }}</span></h3>
                  </div>

                  <div class="body-refacciones">
                      <!-- FORMULARIO SERVICIOS EXTERNOS -->
                      <div class="form-servicios top15px">
                          <div class="row">
                              <div class="col-md-6">
                                <mat-form-field appearance="outline" style="width: 100%;" (click)="cbxServiciosExternos_Clear(); cbxServiciosExternos_Search()">
                                  <mat-label>Servicio Externo</mat-label>
                                  <input #cbxServiciosExternosCBX matInput [(ngModel)]="servicioExternoForm.servicioExternoDesc"
                                        id="cbxServiciosExternosMdl"
                                        [matAutocomplete]="_cbxServiciosExternos"
                                        (keyup)="comboBoxKeyUp('cbxServiciosExternos', cbxServiciosExternosCBX.value, $event)"
                                        (click)="cbxServiciosExternos_Clear()" placeholder="Selecciona...">
                                  <button *ngIf="servicioExternoForm.servicioExternoDesc" matSuffix mat-icon-button aria-label="Clear" (click)="cbxServiciosExternos_Clear()">
                                    <mat-icon>close</mat-icon>
                                  </button>
                                  <mat-autocomplete autoActiveFirstOption #_cbxServiciosExternos="matAutocomplete" (optionSelected)="cbxServiciosExternos_SelectedOption($event)">
                                    <mat-option *ngFor="let role of cbxServiciosExternos" [value]="role">{{ role.name }}</mat-option>
                                    <mat-option value="" *ngIf="cbxServiciosExternos.length == 0 && servicioExternoForm.servicioExternoDesc">No se encontró nada...</mat-option>
                                  </mat-autocomplete>
                                </mat-form-field>
                              </div>
                              <div class="col-md-2">
                                  <mat-form-field class="with100">
                                      <mat-label>Cantidad</mat-label>
                                      <input matInput type="number" [(ngModel)]="servicioExternoForm.cantidad" min="1" placeholder="1">
                                  </mat-form-field>
                              </div>
                              <div class="col-md-2">
                                  <mat-form-field class="with100">
                                      <mat-label>Costo</mat-label>
                                      <input matInput type="number" [(ngModel)]="servicioExternoForm.costo" min="0" placeholder="0">
                                  </mat-form-field>
                              </div>
                              <div class="col-md-2">
                                  <mat-form-field class="with100">
                                      <mat-label>Precio</mat-label>
                                      <input matInput type="number" [(ngModel)]="servicioExternoForm.precio" min="0" placeholder="0">
                                  </mat-form-field>
                              </div>
                          </div>
                      </div>

                      <!-- BOTÓN AGREGAR -->
                      <div class="row top15px">
                          <div class="col-md-12">
                              <button mat-raised-button color="accent" (click)="fn_agregarServicioExterno()" class="btn-agregar">
                                  <mat-icon>add</mat-icon>{{ ( servicioExternoForm.idServicioExternoDetalle > 0 ? 'Editar' : 'Agregar' ) }} Servicio Externo
                              </button>
                          </div>
                      </div>

                      <!-- TABLA DE SERVICIOS EXTERNOS -->
                      <div *ngIf="serviciosExternosList.length > 0" class="table-refacciones top20px">
                          <div class="table-responsive">
                              <table class="table table-hover">
                                  <thead>
                                      <tr class="header-table">
                                          <th class="col-descripcion">Servicios Externos</th>
                                          <th class="col-cantidad">Cantidad</th>
                                          <th class="col-precio">Precio Unit.</th>
                                          <th class="col-total">Total</th>
                                          <th class="col-acciones">Acciones</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <tr *ngFor="let item of serviciosExternosList" class="row-refaccion">
                                          <td class="col-descripcion">{{ item.servicioExtName }}</td>
                                          <td class="col-cantidad text-center">{{ item.cantidad | number:'1.0-0' }}</td>
                                          <td class="col-precio text-right">{{ item.precio | currency }}</td>
                                          <td class="col-total text-right"><strong>{{ item.total | currency }}</strong></td>
                                          <td class="col-acciones text-center">
                                            <button mat-icon-button (click)="editServicioExternoGrid(item)" matTooltip="Editar Refacción">
                                                <mat-icon class="colorGreen">edit</mat-icon>
                                            </button>
                                              <button mat-icon-button (click)="fn_eliminarServicioExterno(item)" matTooltip="Eliminar">
                                                  <mat-icon class="icon-delete">delete_outline</mat-icon>
                                              </button>
                                          </td>
                                      </tr>
                                  </tbody>
                              </table>
                          </div>
                      </div>

                      <!-- MENSAJE VACÍO -->
                      <div *ngIf="serviciosExternosList.length === 0" class="empty-state top20px">
                          <mat-icon>folder_open</mat-icon>
                          <p>No hay servicios externos agregados</p>
                      </div>
                  </div>
              </div>

              <!-- SECCIÓN METAL AGRANEL -->
              <div class="card-refacciones top30px">
                  <div class="header-refacciones">
                      <h3>Metal Agranel <span class="total-metal">Total: {{ totalMetalAgranel | currency }}</span></h3>
                  </div>

                  <div class="body-refacciones">
                      <!-- RadioButton de tipo -->
                      <div class="row">
                          <div class="col-md-12">
                              <mat-label>Tipo de Metal:</mat-label>
                              <div class="radio-group">
                                  <mat-radio-button [value]="'oro'"
                                      [checked]="metalTipo === 'oro'"
                                      (change)="fn_changeMetalTipo('oro')"
                                      class="radio-option">
                                      <mat-icon class="icon-oro" style="color: gold; margin-right: 5px;">circle</mat-icon>
                                      Oro
                                  </mat-radio-button>
                                  <mat-radio-button [value]="'plata'"
                                      [checked]="metalTipo === 'plata'"
                                      (change)="fn_changeMetalTipo('plata')"
                                      class="radio-option">
                                      <mat-icon class="icon-plata" style="color: silver; margin-right: 5px;">circle</mat-icon>
                                      Plata
                                  </mat-radio-button>
                              </div>
                          </div>
                      </div>

                      <!-- FORMULARIO METAL AGRANEL -->
                      <div class="form-metal top15px">
                          <div class="row">
                              <div class="col-md-3">
                                  <mat-form-field class="with100">
                                      <mat-label>Gramos</mat-label>
                                      <input matInput type="number" [(ngModel)]="metalAgranelForm.gramos" min="0" placeholder="0">
                                  </mat-form-field>
                              </div>
                              <div class="col-md-3">
                                  <mat-form-field class="with100">
                                      <mat-label>Kilataje</mat-label>
                                      <mat-select [(ngModel)]="metalAgranelForm.kilates">
                                          <mat-option *ngFor="let kilate of kilatajes" [value]="kilate">
                                              {{ kilate }} Kilates
                                          </mat-option>
                                      </mat-select>
                                  </mat-form-field>
                              </div>
                              <div class="col-md-3">
                                  <mat-form-field class="with100">
                                      <mat-label>Valor del Metal</mat-label>
                                      <input matInput type="number" [(ngModel)]="metalAgranelForm.valorMetal" min="0" placeholder="0.00">
                                  </mat-form-field>
                              </div>
                          </div>
                      </div>

                      <!-- BOTÓN AGREGAR -->
                      <div class="row top15px">
                          <div class="col-md-12">
                              <button mat-raised-button color="accent" (click)="fn_agregarMetalAgranel()" class="btn-agregar">
                                  <mat-icon>add</mat-icon>{{ metalAgranelForm.idMetalAgranel > 0 ? 'Actualizar' : 'Agregar' }} Metal
                              </button>
                          </div>
                      </div>

                      <!-- TABLA DE METAL AGRANEL -->
                      <div *ngIf="metalAgranelList.length > 0" class="table-refacciones top20px">
                          <div class="table-responsive">
                              <table class="table table-hover">
                                  <thead>
                                      <tr class="header-table">
                                          <th class="col-tipo">Tipo</th>
                                          <th class="col-gramos">Gramos</th>
                                          <th class="col-kilates">Kilataje</th>
                                          <th class="col-valor">Valor Metal</th>
                                          <th class="col-acciones">Acciones</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <tr *ngFor="let item of metalAgranelList" class="row-metal">
                                          <td class="col-tipo">
                                              <mat-icon [style.color]="item.tipo === 'oro' ? 'gold' : 'silver'">circle</mat-icon>
                                              {{ item.tipo | uppercase }}
                                          </td>
                                          <td class="col-gramos text-center">{{ item.gramos | number:'1.0-0' }}</td>
                                          <td class="col-kilates text-center">{{ item.kilates | number:'1.0-0' }} K</td>
                                          <td class="col-valor text-right">{{ item.valorMetal | currency }}</td>
                                          <td class="col-acciones text-center">
                                              <button mat-icon-button (click)="editMetalAgranelGrid(item)" matTooltip="Editar Metal">
                                                  <mat-icon class="colorGreen">edit</mat-icon>
                                              </button>
                                              <button mat-icon-button (click)="fn_eliminarMetalAgranel(item.idMetalAgranel)" matTooltip="Eliminar">
                                                  <mat-icon class="icon-delete">delete_outline</mat-icon>
                                              </button>
                                          </td>
                                      </tr>
                                  </tbody>
                              </table>
                          </div>
                      </div>

                      <!-- MENSAJE VACÍO -->
                      <div *ngIf="metalAgranelList.length === 0" class="empty-state top20px">
                          <mat-icon>folder_open</mat-icon>
                          <p>No hay metales agregados</p>
                      </div>
                  </div>
              </div>

              <!-- SECCIÓN METAL DEL CLIENTE -->
              <div class="card-refacciones top30px">
                  <div class="header-refacciones">
                      <h3>Activo del Cliente <span class="total-activo">Total: {{ totalMetalCliente | currency }}</span></h3>
                  </div>

                  <div class="body-refacciones">
                      <!-- RadioButton de tipo -->
                      <div class="row">
                          <div class="col-md-12">
                              <mat-label>Tipo de Metal:</mat-label>
                              <div class="radio-group">
                                  <mat-radio-button [value]="'oro'"
                                      [checked]="metalClienteTipo === 'oro'"
                                      (change)="fn_changeMetalClienteTipo('oro')"
                                      class="radio-option">
                                      <mat-icon class="icon-oro" style="color: gold; margin-right: 5px;">circle</mat-icon>
                                      Oro
                                  </mat-radio-button>
                                  <mat-radio-button [value]="'plata'"
                                      [checked]="metalClienteTipo === 'plata'"
                                      (change)="fn_changeMetalClienteTipo('plata')"
                                      class="radio-option">
                                      <mat-icon class="icon-plata" style="color: silver; margin-right: 5px;">circle</mat-icon>
                                      Plata
                                  </mat-radio-button>
                              </div>
                          </div>
                      </div>

                      <!-- FORMULARIO METAL CLIENTE -->
                      <div class="form-metal top15px">
                          <div class="row">
                              <div class="col-md-3">
                                  <mat-form-field class="with100">
                                      <mat-label>Gramos</mat-label>
                                      <input matInput type="number" [(ngModel)]="metalClienteForm.gramos" min="0" placeholder="0">
                                  </mat-form-field>
                              </div>
                              <div class="col-md-3">
                                  <mat-form-field class="with100">
                                      <mat-label>Kilataje</mat-label>
                                      <mat-select [(ngModel)]="metalClienteForm.kilates">
                                          <mat-option *ngFor="let kilate of kilatajes_cliente" [value]="kilate">
                                              {{ kilate }} Kilates
                                          </mat-option>
                                      </mat-select>
                                  </mat-form-field>
                              </div>
                              <div class="col-md-3">
                                  <mat-form-field class="with100">
                                      <mat-label>Valor del Metal</mat-label>
                                      <input matInput type="number" [(ngModel)]="metalClienteForm.valorMetal" min="0" placeholder="0.00">
                                  </mat-form-field>
                              </div>
                          </div>
                      </div>

                      <!-- BOTÓN AGREGAR -->
                      <div class="row top15px">
                          <div class="col-md-12">
                              <button mat-raised-button color="accent" (click)="fn_agregarMetalCliente()" class="btn-agregar">
                                  <mat-icon>add</mat-icon>{{ metalClienteForm.idMetalCliente > 0 ? 'Actualizar' : 'Agregar' }} Metal
                              </button>
                          </div>
                      </div>

                      <!-- TABLA DE METAL CLIENTE -->
                      <div *ngIf="metalClienteList.length > 0" class="table-refacciones top20px">
                          <div class="table-responsive">
                              <table class="table table-hover">
                                  <thead>
                                      <tr class="header-table">
                                          <th class="col-tipo">Tipo</th>
                                          <th class="col-gramos">Gramos</th>
                                          <th class="col-kilates">Kilataje</th>
                                          <th class="col-valor">Valor Metal</th>
                                          <th class="col-acciones">Acciones</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <tr *ngFor="let item of metalClienteList" class="row-metal">
                                          <td class="col-tipo">
                                              <mat-icon [style.color]="item.tipo === 'oro' ? 'gold' : 'silver'">circle</mat-icon>
                                              {{ item.tipo | uppercase }}
                                          </td>
                                          <td class="col-gramos text-center">{{ item.gramos | number:'1.0-0' }}</td>
                                          <td class="col-kilates text-center">{{ item.kilates | number:'1.0-0' }} K</td>
                                          <td class="col-valor text-right">{{ item.valorMetal | currency }}</td>
                                          <td class="col-acciones text-center">
                                              <button mat-icon-button (click)="editMetalClienteGrid(item)" matTooltip="Editar Metal">
                                                  <mat-icon class="colorGreen">edit</mat-icon>
                                              </button>
                                              <button mat-icon-button (click)="fn_eliminarMetalCliente(item.idMetalCliente)" matTooltip="Eliminar">
                                                  <mat-icon class="icon-delete">delete_outline</mat-icon>
                                              </button>
                                          </td>
                                      </tr>
                                  </tbody>
                              </table>
                          </div>
                      </div>

                      <!-- MENSAJE VACÍO -->
                      <div *ngIf="metalClienteList.length === 0" class="empty-state top20px">
                          <mat-icon>folder_open</mat-icon>
                          <p>No hay metales agregados</p>
                      </div>

                      <!-- SECCIÓN DE IMÁGENES DEL METAL CLIENTE -->
                      <div *ngIf="metalClienteForm.idMetalCliente > 0" class="images-section top30px">
                          <h4 style="margin-bottom: 15px;">Fotos del Metal</h4>

                          <!-- INPUT DE ARCHIVO -->
                          <div class="row top15px">
                              <div class="col-md-6">
                                  <input type="file"
                                         id="metalClienteImageInput"
                                         accept="image/*"
                                         (change)="onFileSelected($event)"
                                         style="margin-bottom: 10px;">
                              </div>
                              <div class="col-md-6">
                                  <button mat-raised-button color="primary" (click)="uploadMetalClienteImage()" class="btn-upload">
                                      <mat-icon>cloud_upload</mat-icon>Subir Foto
                                  </button>
                              </div>
                          </div>

                          <!-- PREVIEW DE IMAGEN SELECCIONADA -->
                          <div *ngIf="imagePreview" class="image-preview top15px">
                              <img [src]="imagePreview" style="max-width: 200px; max-height: 200px; border-radius: 5px;">
                          </div>

                          <!-- CARRUSEL DE IMÁGENES -->
                          <div *ngIf="metalClienteImages.length > 0" class="carousel-section top20px">
                              <div class="carousel-container">
                                  <button mat-icon-button (click)="prevImage()" class="carousel-btn prev">
                                      <mat-icon>navigate_before</mat-icon>
                                  </button>

                                  <div class="carousel-image">
                                      <img [src]="metalClienteImages[currentImageIndex]?.urlImg"
                                           alt="Metal Cliente Image"
                                           style="max-width: 100%; max-height: 400px; border-radius: 5px;">
                                  </div>

                                  <button mat-icon-button (click)="nextImage()" class="carousel-btn next">
                                      <mat-icon>navigate_next</mat-icon>
                                  </button>
                              </div>

                              <!-- INDICADOR DE IMAGEN ACTUAL -->
                              <div class="carousel-info">
                                  <p style="text-align: center; margin-top: 10px;">
                                      Imagen {{ currentImageIndex + 1 }} de {{ metalClienteImages.length }}
                                  </p>
                              </div>

                              <!-- MINIATURAS Y OPCIONES -->
                              <div class="thumbnails-section top15px">
                                  <div class="thumbnails-container">
                                      <div *ngFor="let img of metalClienteImages; let idx = index" class="thumbnail-item">
                                          <img [src]="img.urlImg"
                                               (click)="currentImageIndex = idx"
                                               [style.border]="currentImageIndex === idx ? '3px solid #007bff' : '1px solid #ddd'"
                                               style="max-width: 60px; max-height: 60px; cursor: pointer; border-radius: 3px;">
                                          <button mat-icon-button
                                                  (click)="deleteMetalClienteImage(img.keyX)"
                                                  matTooltip="Eliminar"
                                                  style="position: absolute; top: -10px; right: -10px;">
                                              <mat-icon class="icon-delete" style="font-size: 16px;">delete_outline</mat-icon>
                                          </button>
                                      </div>
                                  </div>
                              </div>
                          </div>

                          <!-- MENSAJE CUANDO NO HAY IMÁGENES -->
                          <div *ngIf="metalClienteImages.length === 0" class="empty-state top20px">
                              <mat-icon>image_not_supported</mat-icon>
                              <p>No hay fotos de este metal aún</p>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- SECCIÓN MANO DE OBRA -->
              <div class="card top30px">
                  <div class="header-card">
                      <h3>Mano de Obra <span class="total-manoobra">Total: {{ totalManoObra | currency }}</span></h3>
                  </div>
                  <div class="body-card">
                      <p>Sección de mano de obra - Por detallar</p>
                  </div>
              </div>

              <!-- Botones de Acción -->
              <div class="row top30px">
                  <div class="col-md-12" style="text-align: right;">
                      <button mat-raised-button
                      type="button"
                      (click)="fn_cancel()">
                      <mat-icon matPrefix class="my-icon">close</mat-icon>
                      Cancelar</button>
                  </div>
              </div>

            </div>


        </div>
    </div>
</div>

<app-spinner [hidden]="!bShowSpinner"></app-spinner>
